{% extends 'ugacaci/base.html' %}
{% load humanize %}
{% block content %}
<div class="container-fluid">
    <h2 class="text-center alert alert-success font-weight-normal">Demande de prêt pour {{ client.nom_prenoms }}</h2>
    <table class="table table-bordered">
        <tbody>
            <tr>
                <th>Nom et prénoms:</th>
                <td>{{ client.nom_prenoms }}</td>
                <th>Date de naissance:</th>
                <td>{{ client.date_naissance }}</td>
                <th>Lieu de naissance:</th>
                <td>{{ client.lieu_naissance }}</td>
            </tr>
            <tr>
                <th>Numéro de téléphone:</th>
                <td>{{ client.numero_telephone }}</td>
                <th>Lieu d'ouverture du compte:</th>
                <td>{{ client.ville }}</td>
                <th>Profession:</th>
                <td>{{ client.profession }}</td>
            </tr>
            <tr>
                <th>Zone d'activité:</th>
                <td colspan="5">{{ client.localite }}</td>
            </tr>
        </tbody>
    </table>

    <div class="container-fluid">
        <h2 class="text-center alert alert-success font-weight-normal">Formulaire du Prêt</h2>

        <form method="post">
            {% csrf_token %}
            <table class="table table-bordered">
                <tbody>
                    <tr>
                        <td>{{ form.montant_demande.label_tag }}</td>
                        <td>{{ form.montant_demande |intcomma }}</td>
                        <td>{{ form.date_demande.label_tag }}</td>
                        <td>
                            <div class="input-group date" data-target-input="nearest">
                                {{ form.date_demande }}
                                <div class="input-group-append" data-target="#datetimepicker1" data-toggle="datetimepicker">
                                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>{{ form.lieu_demande.label_tag }}</td>
                        <td>{{ form.lieu_demande }}</td>
                        <td>{{ form.date_rembourssement.label_tag }}</td>
                        <td>
                            <div class="input-group date" data-target-input="nearest">
                                {{ form.date_rembourssement }}
                                <div class="input-group-append" data-target="#datetimepicker1" data-toggle="datetimepicker">
                                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>{{ form.montant_rembourssement.label_tag }}</td>
                        <td>{{ form.montant_rembourssement|intcomma  }}</td>
                    </tr>
                </tbody>
            </table>
            <div class="text-center mt-3">
                <button type="submit" class="btn btn-primary">Soumettre</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
{% block js %}
<!-- Inclure les fichiers JavaScript de Bootstrap Datepicker -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.fr.min.js"></script>
<!-- Inclure la bibliothèque Moment.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

<script>
    $(document).ready(function(){
        $('.datepicker').datepicker({
            format: 'dd/mm/yyyy', // Format de date désiré
            language: 'fr', // Langue du calendrier (facultatif)
            autoclose: true, // Fermer automatiquement le calendrier après la sélection
            todayHighlight: true, // Mettre en surbrillance la date du jour
            endDate: '+0d', // Empêcher la sélection de dates futures
            clearBtn: true, // Afficher un bouton pour effacer la date sélectionnée
            beforeShowDay: function(date) {
                if (date < new Date()) {
                    return { classes: 'disabled', tooltip: 'Date passée' };
                }
            },
            toggleActive: true // Permettre à l'utilisateur de désélectionner la date
        }).on('changeDate', function(e){
            $(this).datepicker('hide');
        });

        // Afficher un message d'erreur si le format de date est incorrect
        $('.datepicker').on('change', function(){
            var inputDate = $(this).val();
            var parsedDate = moment(inputDate, 'DD/MM/YYYY', true);
            if (!parsedDate.isValid()) {
                $(this).addClass('is-invalid');
                $(this).next('.invalid-feedback').text('Format de date incorrect. Veuillez utiliser le format JJ/MM/AAAA.');
            } else {
                $(this).removeClass('is-invalid');
                $(this).next('.invalid-feedback').text('');
            }
        });
    });
</script>
{% endblock %}
